<!--
+-------------------------------------------------------------+
|                          CERTEUS                            |
+-------------------------------------------------------------+
| FILE: clients/web/public/mailops.html                      |
| ROLE: Web client page (MailOps ingest).                      |
| PLIK: clients/web/public/mailops.html                      |
| ROLA: Strona web (MailOps ingest).                            |
+-------------------------------------------------------------+
-->
<!doctype html>
<html lang="pl" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="CERTEUS MailOps ingest" />
    <title>CERTEUS • MailOps</title>
    <style>
      body{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#111315;color:#f2f2f3}
      .container{max-width:920px;margin:24px auto;padding:0 16px}
      .card{background:#181b20;border:1px solid #2a2d33;border-radius:12px;padding:16px}
      h1{margin:0 0 10px;font-size:22px}
      input,textarea{width:100%;background:#1a1c20;border:1px solid #2a2d33;border-radius:10px;color:#f2f2f3;padding:8px 10px}
      .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
      .btn{background:#1a1c20;border:1px solid #2a2d33;color:#f2f2f3;padding:8px 12px;border-radius:10px;cursor:pointer}
      .btn:hover{background:#20242a}
      pre{white-space:pre-wrap;background:#0f1115;border:1px solid #2a2d33;border-radius:10px;padding:12px}
      .muted{color:#9aa0a6}
      label{font-size:12px;color:#9aa0a6}
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <h1>MailOps • Ingest</h1>
        <div class="row">
          <div>
            <label>mail_id</label>
            <input id="mail_id" placeholder="MAIL-001" />
          </div>
          <div>
            <label>thread_id</label>
            <input id="thread_id" placeholder="(opcjonalnie)" />
          </div>
          <div>
            <label>from_addr</label>
            <input id="from_addr" placeholder="alice@example.com" />
          </div>
          <div>
            <label>to (comma)</label>
            <input id="to" placeholder="ops@example.com, sre@example.com" />
          </div>
          <div>
            <label>subject</label>
            <input id="subject" placeholder="Hello" />
          </div>
          <div>
            <label>body_text</label>
            <input id="body_text" placeholder="Test" />
          </div>
          <div>
            <label>SPF</label>
            <input id="spf" placeholder="pass" />
          </div>
          <div>
            <label>DKIM</label>
            <input id="dkim" placeholder="pass" />
          </div>
          <div>
            <label>DMARC</label>
            <input id="dmarc" placeholder="pass" />
          </div>
        </div>
        <div style="margin-top:12px">
          <button class="btn" id="send">Send</button>
        </div>
        <p class="muted">Response:</p>
        <pre id="out"></pre>
        <p class="muted">Ledger: <a id="mlink" href="#" target="_blank">open records</a></p>
      </div>
    </div>
    <script>
      async function send(){
        const body={
          mail_id: (document.getElementById('mail_id').value||'MAIL-001').trim(),
          thread_id: (document.getElementById('thread_id').value||'').trim()||null,
          from_addr: (document.getElementById('from_addr').value||'alice@example.com').trim(),
          to: (document.getElementById('to').value||'ops@example.com').split(',').map(x=>x.trim()).filter(Boolean),
          subject: (document.getElementById('subject').value||'Hello').trim(),
          body_text: (document.getElementById('body_text').value||'Test').trim(),
          spf: (document.getElementById('spf').value||'pass').trim(),
          dkim: (document.getElementById('dkim').value||'pass').trim(),
          dmarc: (document.getElementById('dmarc').value||'pass').trim(),
          attachments: []
        };
        const r = await fetch('/v1/mailops/ingest',{method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify(body)});
        const txt = await r.text();
        try{ const j = JSON.parse(txt); document.getElementById('out').textContent = JSON.stringify(j, null, 2); const tid = (j.io && (j.io['io.email.thread_id']||j.io['io.email.mail_id'])) || body.thread_id || body.mail_id; if(tid){ document.getElementById('mlink').href = `/v1/ledger/${encodeURIComponent(tid)}/records`; } }catch{ document.getElementById('out').textContent = txt; }
      }
      document.getElementById('send').addEventListener('click', send);
    </script>
  </body>
  </html>
