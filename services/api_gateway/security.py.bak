#!/usr/bin/env python3
"""
PL: Lekki middleware bezpieczeÅ„stwa (no-op w testach), opcjonalnie wymusza proof-only I/O
    po ustawieniu STRICT_PROOF_ONLY=1.
EN: Lightweight security middleware (no-op in tests); optionally enforces proof-only I/O
    when STRICT_PROOF_ONLY=1.
"""

from __future__ import annotations

from collections.abc import Callable
import os

from fastapi import FastAPI, Request, Response

__all__ = ["attach_proof_only_middleware"]


def attach_proof_only_middleware(app: FastAPI) -> None:
    if os.getenv("STRICT_PROOF_ONLY") != "1":
        return

    @app.middleware("http")
    async def _proof_only(request: Request, call_next: Callable[[Request], Response]):  # type: ignore[override]
        # Miejsce na twardsze polityki I/O; teraz przepuszczamy wszystko.
        return await call_next(request)

