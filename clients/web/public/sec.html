<!--
+-------------------------------------------------------------+
|                          CERTEUS                            |
+-------------------------------------------------------------+
| FILE: clients/web/public/sec.html                           |
| ROLE: Web client page.                                      |
| PLIK: clients/web/public/sec.html                           |
| ROLA: Strona klienta web (SEC).                             |
+-------------------------------------------------------------+
-->

<!doctype html>
<html lang="pl" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CERTEUS • SEC View</title>
    <style>
      body {
        font-family:
          ui-sans-serif,
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Arial;
        margin: 0;
        background: #111315;
        color: #f2f2f3;
      }
      .container {
        max-width: 980px;
        margin: 24px auto;
        padding: 0 16px;
      }
      .card {
        background: #181b20;
        border: 1px solid #2a2d33;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 16px;
      }
      h1 {
        margin: 0 0 10px;
        font-size: 22px;
      }
      .row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
      }
      .btn {
        background: #1a1c20;
        border: 1px solid #2a2d33;
        color: #f2f2f3;
        padding: 8px 12px;
        border-radius: 10px;
        cursor: pointer;
      }
      .btn:hover {
        background: #20242a;
      }
      .muted {
        color: #9aa0a6;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th,
      td {
        border-bottom: 1px solid #2a2d33;
        padding: 8px 10px;
        text-align: left;
      }
      .pill {
        display: inline-block;
        padding: 4px 8px;
        border: 1px solid #2a2d33;
        border-radius: 999px;
        background: #20242a;
        margin-left: 8px;
      }
      input,
      textarea {
        background: #1a1c20;
        border: 1px solid #2a2d33;
        border-radius: 10px;
        color: #f2f2f3;
        padding: 8px 10px;
      }
    </style>
  </head>
  <body>
    <a
      href="#main"
      class="sr-only sr-only-focusable"
      aria-label="Skip to main content"
      >Pomiń do treści głównej</a
    >
    <main id="main" role="main">
      <div class="container">
        <div class="row" style="justify-content: flex-end; margin-bottom: 8px">
          <label class="muted" for="lang">Lang</label>
          <select id="lang" aria-label="Language select" class="btn">
            <option value="pl" selected>PL</option>
            <option value="en">EN</option>
          </select>
        </div>
        <div class="card">
          <h1 id="title-sec" data-i18n="title">SEC • Headers & Rate‑Limit</h1>
          <div class="row">
            <button class="btn" id="probe" data-i18n="probe">
              Probe /health
            </button>
            <span id="status" class="muted"></span>
          </div>
          <pre
            id="headers"
            style="
              background: #0f1115;
              border: 1px solid #2a2d33;
              padding: 12px;
              border-radius: 8px;
              overflow: auto;
              max-height: 220px;
            "
          ></pre>
        </div>
        <div class="card">
          <h1 data-i18n="packs">SEC • Domain Packs</h1>
          <div class="row">
            <input id="q" placeholder="filtr" aria-label="Filtr" /><button
              class="btn"
              id="refresh"
              data-i18n="refresh"
            >
              Odśwież</button
            ><span class="muted"
              ><span data-i18n="count_label">Liczba</span>:
              <span id="count" class="pill">0</span></span
            >
          </div>
          <table>
            <thead>
              <tr>
                <th>Nazwa</th>
                <th>Wersja</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody id="rows"></tbody>
          </table>
        </div>
      </div>
    </main>
    <script>
      document.getElementById("probe").onclick = async () => {
        const t0 = performance.now();
        const r = await fetch("/health");
        const t1 = performance.now();
        const hdrs = {};
        r.headers.forEach((v, k) => (hdrs[k] = v));
        document.getElementById("status").textContent =
          `HTTP ${r.status} • ${(t1 - t0).toFixed(1)} ms`;
        document.getElementById("headers").textContent = JSON.stringify(
          hdrs,
          null,
          2,
        );
      };
      async function listPacks() {
        const r = await fetch("/v1/packs/");
        return r.ok ? await r.json() : [];
      }
      function render(packs) {
        const q = (document.getElementById("q").value || "").toLowerCase();
        const f = packs.filter(
          (p) => !q || (p.name || "").toLowerCase().includes(q),
        );
        const tb = document.getElementById("rows");
        tb.innerHTML = f
          .map(
            (p) =>
              `<tr><td>${p.name}</td><td>${p.version || "-"}</td><td>${p.enabled ? '<span class=\"pill\">enabled</span>' : ""} ${p.signature ? '<span class=\"pill\">signed</span>' : ""}</td></tr>`,
          )
          .join("");
        document.getElementById("count").textContent = String(f.length);
      }
      async function refresh() {
        render(await listPacks());
      }
      document.getElementById("refresh").onclick = refresh;
      document.getElementById("q").oninput = refresh;
      const I18N = {
        pl: {
          title: "SEC • Nagłówki i limity",
          probe: "Probe /health",
          packs: "SEC • Pakiety domenowe",
          refresh: "Odśwież",
          count_label: "Liczba",
        },
        en: {
          title: "SEC • Headers & Rate‑Limit",
          probe: "Probe /health",
          packs: "SEC • Domain Packs",
          refresh: "Refresh",
          count_label: "Count",
        },
      };
      function getLang() {
        const u = new URL(location.href);
        const p = (u.searchParams.get("lang") || "").toLowerCase();
        return p === "en" || p === "pl" ? p : "pl";
      }
      function applyI18n() {
        const lang = getLang();
        const d = I18N[lang] || I18N.pl;
        document.getElementById("title-sec").textContent = d.title;
        document.querySelectorAll("[data-i18n]").forEach((el) => {
          const k = el.getAttribute("data-i18n");
          if (d[k]) el.textContent = d[k];
        });
        const sel = document.getElementById("lang");
        sel.value = lang;
        sel.onchange = () => {
          const url = new URL(location.href);
          url.searchParams.set("lang", sel.value);
          location.href = url.toString();
        };
      }
      applyI18n();
      refresh();
    </script>
    <style>
      :focus-visible {
        outline: 2px solid #8a8f98;
        outline-offset: 2px;
      }
      .sr-only {
        position: absolute;
        left: -10000px;
        top: auto;
        width: 1px;
        height: 1px;
        overflow: hidden;
      }
      .sr-only-focusable:focus {
        position: static;
        width: auto;
        height: auto;
        padding: 8px 10px;
        margin: 6px;
        background: #181b20;
        border: 2px solid #8a8f98;
        border-radius: 8px;
      }
    </style>
  </body>
</html>
