<!--
+-------------------------------------------------------------+
|                          CERTEUS                            |
+-------------------------------------------------------------+
| FILE: clients/web/public/chatops.html                       |
| ROLE: Web client page (ChatOps UI).                         |
| PLIK: clients/web/public/chatops.html                       |
| ROLA: Strona klienta web (ChatOps UI).                      |
+-------------------------------------------------------------+
-->

<!doctype html>
<html lang="pl" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CERTEUS • ChatOps</title>
    <style>
      body {
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
        margin: 0;
        background: #111315;
        color: #f2f2f3;
      }
      .container { max-width: 920px; margin: 24px auto; padding: 0 16px; }
      .card {
        background: #181b20;
        border: 1px solid #2a2d33;
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 16px;
      }
      h1 { margin: 0 0 12px; font-size: 22px; }
      .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
      label { font-size: 14px; color: #c9cdd3; }
      input, textarea, select {
        background: #1a1c20; border: 1px solid #2a2d33; color: #f2f2f3;
        padding: 8px 10px; border-radius: 10px; width: 100%;
      }
      textarea { min-height: 120px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; }
      .btn { background: #1a1c20; border: 1px solid #2a2d33; color: #f2f2f3; padding: 8px 12px; border-radius: 10px; cursor: pointer; }
      .btn:hover { background: #20242a; }
      .muted { color: #9aa0a6; }
      pre { background: #0f1115; border: 1px solid #2a2d33; padding: 12px; border-radius: 8px; overflow: auto; }
      .pill { display: inline-block; padding: 4px 8px; border: 1px solid #2a2d33; border-radius: 999px; background: #20242a; margin-left: 8px; }
      .grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
      @media (min-width: 720px) { .grid { grid-template-columns: 1fr 1fr; } }
    </style>
  </head>
  <body>
    <a href="#main" class="sr-only sr-only-focusable">Pomiń do treści głównej</a>
    <main id="main" role="main">
      <div class="container">
        <div class="row" style="justify-content:flex-end; margin-bottom:8px">
          <label for="lang" class="muted">Lang</label>
          <select id="lang" aria-label="Language select" class="btn">
            <option value="pl" selected>PL</option>
            <option value="en">EN</option>
          </select>
        </div>
        <div class="card">
          <h1 id="title">ChatOps • Komendy</h1>
          <p class="muted" id="subtitle">Wyślij komendę ChatOps do API.</p>
          <div class="grid">
            <div>
              <label for="cmd">Komenda</label>
              <select id="cmd">
                <option value="qtm.measure">qtm.measure</option>
                <option value="cfe.geodesic">cfe.geodesic</option>
                <option value="lexqft.tunnel">lexqft.tunnel</option>
              </select>
            </div>
            <div>
              <label for="args">Argumenty (JSON)</label>
              <textarea id="args" aria-label="Argumenty JSON">{
  "operator": "W",
  "case": "chatops-case-1"
}</textarea>
            </div>
          </div>
          <div class="row" style="margin-top:10px">
            <button id="send" class="btn" data-i18n="send">Wyślij</button>
            <span class="muted"><span data-i18n="status">Status</span>: <span id="st" class="pill">-</span></span>
            <button id="copyCurl" class="btn">Copy curl</button>
          </div>
        </div>
        <div class="card">
          <h1>Wynik</h1>
          <pre id="out" aria-live="polite"></pre>
          <h1>Nagłówki PCO</h1>
          <pre id="pco"></pre>
        </div>
      </div>
    </main>
    <script>
      const I18N = {
        pl: { title: "ChatOps • Komendy", subtitle: "Wyślij komendę ChatOps do API.", send: "Wyślij", status: "Status" },
        en: { title: "ChatOps • Commands", subtitle: "Send a ChatOps command to API.", send: "Send", status: "Status" }
      };
      function getLang(){
        const u=new URL(location.href); const p=(u.searchParams.get('lang')||'').toLowerCase();
        return p==='en'||p==='pl'?p:'pl';
      }
      function applyI18n(){
        const lang=getLang(); const d=I18N[lang]||I18N.pl;
        document.getElementById('title').textContent=d.title;
        document.getElementById('subtitle').textContent=d.subtitle;
        document.querySelectorAll('[data-i18n]').forEach(el=>{ const k=el.getAttribute('data-i18n'); if(d[k]) el.textContent=d[k]; });
        const sel=document.getElementById('lang'); sel.value=lang; sel.onchange=()=>{ const url=new URL(location.href); url.searchParams.set('lang', sel.value); location.href=url.toString(); };
      }
      function buildCurl(cmd, args){
        const body=JSON.stringify({cmd, args});
        return `curl -sS -X POST http://127.0.0.1:8000/v1/chatops/command -H 'content-type: application/json' -d '${body.replace(/'/g, "'\''")}'`;
      }
      async function send(){
        const cmd=document.getElementById('cmd').value;
        let args={};
        try { args=JSON.parse(document.getElementById('args').value||'{}'); }
        catch(e){ alert('Błędny JSON w argumentach'); return; }
        document.getElementById('st').textContent='…';
        try{
          const r=await fetch('/v1/chatops/command',{ method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({cmd, args})});
          const txt=await r.text();
          document.getElementById('out').textContent=txt;
          const pco = {};
          (r.headers || new Headers()).forEach((v,k)=>{ if(k.toLowerCase().startsWith('x-certeus-pco-')) pco[k]=v; });
          document.getElementById('pco').textContent=JSON.stringify(pco, null, 2);
          document.getElementById('st').textContent=r.ok? 'OK':'ERR';
          document.getElementById('copyCurl').onclick=()=>navigator.clipboard.writeText(buildCurl(cmd,args));
        }catch(e){ document.getElementById('st').textContent='ERR'; document.getElementById('out').textContent=String(e); }
      }
      applyI18n();
      document.getElementById('send').addEventListener('click', send);
    </script>
    <style>
      :focus-visible { outline: 2px solid #8a8f98; outline-offset: 2px; }
      .sr-only { position: absolute; left: -10000px; top: auto; width: 1px; height: 1px; overflow: hidden; }
      .sr-only-focusable:focus { position: static; width: auto; height: auto; padding: 8px 10px; margin: 6px; background: #181b20; border: 2px solid #8a8f98; border-radius: 8px; }
    </style>
  </body>
  </html>

