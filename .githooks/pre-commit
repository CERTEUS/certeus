#!/usr/bin/env bash
set -euo pipefail

# Block hard-coded sensitive paths regardless of denylist.txt
mapfile -t STAGED < <(git diff --cached --name-only)
BLOCKED_PATTERNS=(
  ".env"
  ".env.local"
  ".env.*"
  ".devkeys/**"
  "secrets/**"
  "**/*.pem"
  "**/*.key"
  "**/id_rsa*"
  "**/id_ed25519*"
)
viol=()
for f in "${STAGED[@]}"; do
  for pat in "${BLOCKED_PATTERNS[@]}"; do
    if [[ "$f" == $pat ]]; then
      viol+=("$f (matches $pat)")
      break
    fi
  done
done
if (( ${#viol[@]} > 0 )); then
  echo "Commit blocked: sensitive files detected:" >&2
  printf ' - %s\n' "${viol[@]}" >&2
  exit 1
fi

exit 0
