<!--
+-------------------------------------------------------------+
|                          CERTEUS                            |
+-------------------------------------------------------------+
| FILE: clients/web/public/code.html                          |
| ROLE: Web client page.                                      |
| PLIK: clients/web/public/code.html                          |
| ROLA: Strona klienta web (CODE).                            |
+-------------------------------------------------------------+
-->

<!doctype html>
<html lang="pl" data-theme="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>CERTEUS • CODE View</title>
    <style>
      body{font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#111315;color:#f2f2f3}
      .container{max-width:980px;margin:24px auto;padding:0 16px}
      .card{background:#181b20;border:1px solid #2a2d33;border-radius:12px;padding:16px;margin-bottom:16px}
      h1{margin:0 0 10px;font-size:22px}
      .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
      .btn{background:#1a1c20;border:1px solid #2a2d33;color:#f2f2f3;padding:8px 12px;border-radius:10px;cursor:pointer}
      .btn:hover{background:#20242a}
      .muted{color:#9aa0a6}
      table{width:100%;border-collapse:collapse}
      th,td{border-bottom:1px solid #2a2d33;padding:8px 10px;text-align:left}
      .pill{display:inline-block;padding:4px 8px;border:1px solid #2a2d33;border-radius:999px;background:#20242a;margin-left:8px}
      input,textarea{background:#1a1c20;border:1px solid #2a2d33;border-radius:10px;color:#f2f2f3;padding:8px 10px;}
      .tag{display:inline-block;margin-right:6px;margin-bottom:4px;padding:2px 6px;border-radius:8px;border:1px solid #2a2d33;background:#20242a;font-size:12px}
    </style>
  </head>
  <body>
    <div class="container">
      <div class="card">
        <h1>CODE • Domain Packs</h1>
        <div class="row" style="margin-bottom:8px;">
          <input id="q" placeholder="filtruj" />
          <button class="btn" id="refresh">Odśwież</button>
          <span class="muted">Liczba: <span id="count" class="pill">0</span></span>
        </div>
        <table>
          <thead>
            <tr><th>Nazwa</th><th>Wersja</th><th>ABI</th><th>Status</th><th>Akcja</th></tr>
          </thead>
          <tbody id="rows"></tbody>
        </table>
      </div>
      <div class="card">
        <h1>Try • TPL diff (demo)</h1>
        <div class="row" style="margin-bottom:8px;">
          <input id="pack" placeholder="pack name (np. tpl_diff_pl)" />
          <button class="btn" id="try">Try</button>
        </div>
        <textarea id="payload" rows="8" style="width:100%">{
  "act_id": "DEMO-ACT",
  "v_from": "v1",
  "v_to": "v2"
}</textarea>
        <pre id="out" style="background:#0f1115;border:1px solid #2a2d33;padding:12px;border-radius:8px;overflow:auto;max-height:280px;margin-top:8px;"></pre>
      </div>
    </div>
    <script>
      async function listPacks(){ const r=await fetch('/v1/packs/'); return r.ok?await r.json():[]; }
      function render(packs){
        const q=(document.getElementById('q').value||'').toLowerCase();
        const filtered=packs.filter(p=>!q || (p.name||'').toLowerCase().includes(q));
        const tb=document.getElementById('rows');
        tb.innerHTML = filtered.map(p=>{
          const status = `${p.enabled?'<span class="pill">enabled</span>':''} ${p.signature?'<span class="pill">signed</span>':''}`;
          const btn = `<button class=\"btn try\" data-pack=\"${p.name}\">Try</button>`;
          return `<tr><td>${p.name}</td><td>${p.version||'-'}</td><td><code>${p.abi}</code></td><td>${status}</td><td>${btn}</td></tr>`;
        }).join('');
        document.getElementById('count').textContent=String(filtered.length);
        Array.from(document.querySelectorAll('button.try')).forEach(btn=>{
          btn.onclick=()=>{ document.getElementById('pack').value=btn.getAttribute('data-pack'); };
        });
      }
      async function refresh(){ render(await listPacks()); }
      document.getElementById('refresh').onclick=refresh;
      document.getElementById('q').oninput=refresh;
      document.getElementById('try').onclick=async ()=>{
        const name=(document.getElementById('pack').value||'').trim();
        let payload={}; try{ const raw=document.getElementById('payload').value; if(raw.trim()) payload=JSON.parse(raw); }catch(_){ }
        const r = await fetch('/v1/packs/try',{method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify({pack:name, payload})});
        const j = await r.json(); document.getElementById('out').textContent = JSON.stringify(j,null,2);
      };
      refresh();
    </script>
  </body>
  </html>

