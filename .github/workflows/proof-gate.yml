# +=====================================================================+
# |                              CERTEUS                                |
# +=====================================================================+
# | FILE:   .github/workflows/proof-gate.yml                            |
# | ROLE:   Proof gate (tests + proof generation + external check)      |
# | DATE:   2025-08-17                                                  |
# +=====================================================================+

name: proof-gate

on:
  pull_request:
  push:
    branches: [ main ]

permissions:
  contents: read

jobs:
  gate:
    runs-on: ubuntu-latest
    env:
      PROOF_ARTIFACTS: proof-artifacts
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v1
      - name: Sync deps
        run: uv sync
      - name: Unit tests â€“ truth kernel
        run: uv run pytest -q tests/truth
      - name: Generate proofs (stub ok)
        run: |
          mkdir -p "$PROOF_ARTIFACTS"
          uv run python scripts/generate_proofs.py --out "$PROOF_ARTIFACTS"
      - name: External proof check (DRAT/LFSC)
        run: |
          bash scripts/check_drat.sh -d "$PROOF_ARTIFACTS" -f z3.drat
          bash scripts/check_lfsc.sh -d "$PROOF_ARTIFACTS" -f cvc5.lfsc
